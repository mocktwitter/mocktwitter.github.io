<!doctype html>
<title>Chat</title>
<div id="log" style="height:50vh;overflow:auto;border:1px solid #ccc;padding:8px"></div>
<form id="f"><input id="author" placeholder="name"/> <input id="m" placeholder="message"/><button>Send</button></form>
<script>
const ws = new WebSocket((location.protocol==="https:"?"wss":"ws")+"://"+location.host+"/ws/lobby");
const log=document.getElementById("log");
ws.onmessage=e=>{
  const d=JSON.parse(e.data);
  if(d.type==="msg"){add(`${d.author||"anon"}: ${d.text}`);}
  if(d.type==="history"){for(const m of d.messages)add(`${m.author||"anon"}: ${m.text}`);}
};
document.getElementById("f").onsubmit=e=>{
  e.preventDefault();
  ws.send(JSON.stringify({type:"send",author:author.value,text:m.value}));
  m.value="";
};
function add(t){const div=document.createElement("div");div.textContent=t;log.appendChild(div);log.scrollTop=log.scrollHeight;}
</script>
