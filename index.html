<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<script>
  const BACKEND = "https://promises-charlie-warranties-theaters.trycloudflare.com";

  const logDiv = document.getElementById("log");
  function line(t){
    const d = document.createElement("div");
    d.textContent = typeof t === "string" ? t : JSON.stringify(t);
    logDiv.appendChild(d);
    logDiv.scrollTop = logDiv.scrollHeight;
  }

  const socket = io(BACKEND, { transports: ["websocket"] });

  // 1) receive full history on connect
  socket.on("history", (arr) => {
    logDiv.innerHTML = "";
    for (const m of arr) line(m);
    line("— history loaded —");
  });

  // 2) live messages
  socket.on("connect", () => line("connected"));
  socket.on("message", (m) => line(m));

  // 3) send
  document.getElementById("send").onclick = () => {
    const el = document.getElementById("msg");
    const v = el.value.trim();
    if (v) { socket.send(v); el.value = ""; }
  };
</script>
